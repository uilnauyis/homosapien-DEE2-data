---
title: "Data Preparation Workflow (Section 3)"
author: "Siyuan"
date: "7/25/2020"
output: 
  html_document:
    fig_width: 10
    fig_height: 8
---

Deseq2 normalization of gene-level count data summarzied from transcript-level data with 'tximport'

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, # show code
                      message = FALSE # hide console output
                      )
```

### Step 1: Load library
```{r}
## load the library
library(DEE2HsapienData)
library(SummarizedExperiment)
```

### Step 2: Reload DEE2 data
```{r}
tempDirPath <- paste(getwd(), 'temp', sep = '/')
dee2DataPath <- paste(tempDirPath, 'dee2Data', sep='/')
dee2Data <- readRDS(dee2DataPath)
```

### Step 3: Normalize count data and plot PCA plots
```{r}
dESeq2NormalizedDataFromTxLevelData <- 
  Deseq2NormalizationFromTranscriptLevelData(dee2Data)

```
### Step 4: PCA plots
Compare PCA plots of data before normalization and normalized data

#### PCA plots of data before normalization
```{r}
pcaPlot(dee2Data$sExpr)
pcaPlot2d <- pcaPlot(dee2Data$sExpr, plot = '2d')
pcaPlot2d[[1]]
pcaPlot2d[[2]]
pcaPlot2d[[3]]
```
#### PCA plots of data after Deseq2 normalization
```{r}

pcaPlot(dESeq2NormalizedDataFromTxLevelData$normalizedSExpr)
pcaPlot2d <- pcaPlot(dESeq2NormalizedDataFromTxLevelData$normalizedSExpr, 
        plot = '2d')
pcaPlot2d[[1]]
pcaPlot2d[[2]]
pcaPlot2d[[3]]
```
#### Save the normalized data
```{r}
saveRDS(dESeq2NormalizedDataFromTxLevelData, 
        file=paste(tempDirPath, 'dESeq2NormalizedDataFromTxLevelData', sep='/'))
```